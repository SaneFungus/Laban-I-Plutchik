<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImproLab: Kontrapunkt 2.0</title>
    <style>
        :root {
            --bg-dark: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --text-sub: #a0a0a0;
            --accent: #e74c3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a2e 100%);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            position: relative;
        }

        /* Language Switcher */
        .lang-switch {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .lang-btn {
            background: transparent;
            border: 1px solid #444;
            color: #888;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
            width: auto;
            box-shadow: none;
        }

        .lang-btn:hover {
            border-color: #666;
            color: #fff;
            transform: none;
            box-shadow: none;
        }

        .lang-btn:focus-visible {
            outline: 2px solid #667eea;
            outline-offset: 1px;
        }

        .lang-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            font-weight: bold;
        }

        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        h1 {
            font-weight: 300;
            letter-spacing: 2px;
            margin-bottom: 5px;
            text-transform: uppercase;
            font-size: 1.8rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-top: 30px;
        }

        .subtitle {
            color: var(--text-sub);
            font-size: 0.9rem;
            margin-bottom: 25px;
            max-width: 500px;
            text-align: center;
            line-height: 1.5;
        }

        /* --- Panel Sterowania --- */
        .controls {
            background: #252525;
            padding: 20px;
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            margin-bottom: 25px;
            box-sizing: border-box;
            border: 1px solid #333;
        }

        .control-label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 5px;
            display: block;
        }

        select {
            width: 100%;
            padding: 12px;
            background: #333;
            color: white;
            border: 1px solid #444;
            border-radius: 6px;
            font-size: 1rem;
            margin-bottom: 15px;
            cursor: pointer;
        }

        select:hover {
            border-color: #555;
        }

        select:focus-visible {
            outline: 2px solid #667eea;
            outline-offset: 1px;
        }

        button.gen-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50px;
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        button.gen-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        button.gen-btn:active {
            transform: scale(0.97);
        }

        button.gen-btn:focus-visible {
            outline: 3px solid #fff;
            outline-offset: 2px;
        }

        /* Keyboard Shortcut Hint */
        .kbd-hint {
            display: inline-block;
            font-size: 0.7rem;
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 4px;
            padding: 2px 6px;
            background: rgba(0, 0, 0, 0.2);
            font-weight: normal;
            line-height: 1.2;
        }

        /* --- Karty Postaci --- */
        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 25px;
            width: 100%;
            max-width: 1000px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 0;
            width: 100%;
            max-width: 470px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
            border: 1px solid #2a2a2a;
            position: relative;
            display: flex;
            flex-direction: column;
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }

        .card-header {
            background: linear-gradient(135deg, #2a2a2a, #1e1e1e);
            padding: 12px;
            text-align: center;
            font-size: 1rem;
            font-weight: bold;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 1px solid #333;
        }

        /* Sekcja Wewnƒôtrzna (Emocja) */
        .section-emo {
            padding: 25px 20px;
            text-align: center;
            color: #222;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .section-emo::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        @keyframes popIn {
            0% { transform: scale(0.95); opacity: 0.5; }
            100% { transform: scale(1); opacity: 1; }
        }

        .animate-pop {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @media (prefers-reduced-motion: reduce) {
            *, ::before, ::after {
                animation-duration: 0.01s !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01s !important;
                scroll-behavior: auto !important;
            }
        }

        .emo-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            opacity: 0.8;
            font-weight: bold;
            margin-bottom: 8px;
            letter-spacing: 1px;
            position: relative;
        }

        .emo-value {
            font-size: 2.5rem;
            font-weight: 900;
            text-transform: uppercase;
            line-height: 1;
            position: relative;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        /* Wektory Emocjonalne */
        .emotion-vectors {
            background: #181818;
            padding: 15px;
            margin: 15px;
            border-radius: 10px;
            border: 1px solid #2a2a2a;
        }

        .vectors-title {
            font-size: 0.7rem;
            color: #666;
            text-transform: uppercase;
            font-weight: bold;
            margin-bottom: 12px;
            text-align: center;
            letter-spacing: 1px;
        }

        .vector-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
        }

        .vector-item {
            background: #222;
            padding: 8px 6px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #333;
            transition: all 0.2s;
        }

        .vector-item:hover {
            background: #282828;
            border-color: #444;
        }

        .vector-label {
            font-size: 0.6rem;
            color: #777;
            text-transform: uppercase;
            display: block;
            margin-bottom: 4px;
            letter-spacing: 0.5px;
        }

        .vector-value {
            font-size: 0.85rem;
            color: #fff;
            font-weight: bold;
            line-height: 1.2;
        }

        /* Sekcja Zewnƒôtrzna (Laban) */
        .section-body {
            padding: 20px;
            background: #1e1e1e;
            flex-grow: 1;
        }

        .body-header {
            text-align: center;
            font-size: 0.75rem;
            color: #666;
            text-transform: uppercase;
            font-weight: bold;
            margin-bottom: 15px;
            letter-spacing: 1px;
        }

        /* Grid dla czynnik√≥w Labana */
        .laban-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin-bottom: 20px;
        }

        .factor {
            background: #252525;
            padding: 10px 5px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid #333;
            transition: all 0.2s;
        }

        .factor:hover {
            background: #2a2a2a;
            border-color: #444;
        }

        .f-label { 
            font-size: 0.65rem; 
            color: #888; 
            display: block; 
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .f-val { 
            font-size: 0.95rem; 
            color: #fff; 
            font-weight: bold; 
        }

        /* Wynik Labana (Akcja) */
        .laban-result {
            background: linear-gradient(135deg, #2c2c2c, #252525);
            border: 1px dashed #555;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin-top: 15px;
        }

        .action-name {
            font-size: 1.8rem;
            font-weight: bold;
            color: #fff;
            margin-bottom: 5px;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .action-desc {
            font-size: 0.9rem;
            color: #bbb;
            font-style: italic;
        }

        .instruction {
            padding: 12px;
            text-align: center;
            font-size: 0.85rem;
            color: #888;
            background: linear-gradient(135deg, #1a1a1a, #181818);
            border-top: 1px solid #2a2a2a;
            font-style: italic;
        }

        /* Kolory Emocji (Plutchik) - Zaktualizowane */
        .c-radosc { 
            background: linear-gradient(135deg, #FFD700, #FFA500); 
            color: #333 !important;
        }
        .c-zaufanie { 
            background: linear-gradient(135deg, #9ACD32, #7CB342);
            color: #333 !important;
        }
        .c-strach { 
            background: linear-gradient(135deg, #2E8B57, #1B5E3F); 
            color: white !important; 
        }
        .c-zdziwienie { 
            background: linear-gradient(135deg, #00BFFF, #0288D1);
            color: white !important;
        }
        .c-smutek { 
            background: linear-gradient(135deg, #4169E1, #3949AB); 
            color: white !important; 
        }
        .c-wstret { 
            background: linear-gradient(135deg, #9370DB, #7B1FA2);
            color: white !important;
        }
        .c-gniew { 
            background: linear-gradient(135deg, #DC143C, #B71C1C); 
            color: white !important; 
        }
        .c-oczekiwanie { 
            background: linear-gradient(135deg, #FF8C00, #F57C00);
            color: #333 !important;
        }

        /* Separator wizualny */
        .divider {
            height: 1px;
            background: linear-gradient(to right, transparent, #444, transparent);
            margin: 15px 20px;
        }

        /* Responsywno≈õƒá */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .card {
                max-width: 100%;
            }

            h1 {
                font-size: 1.5rem;
            }

            .vector-grid {
                grid-template-columns: 1fr;
                gap: 6px;
            }

            .lang-switch {
                position: absolute;
                top: 10px;
                right: 10px;
            }
        }

    </style>
</head>
<body>

    <div class="lang-switch">
        <button onclick="setLanguage('pl')" id="btn-pl" class="lang-btn active" aria-pressed="true" aria-label="Polski">PL</button>
        <button onclick="setLanguage('en')" id="btn-en" class="lang-btn" aria-pressed="false" aria-label="English">EN</button>
    </div>

    <div id="a11y-announcer" class="visually-hidden" aria-live="polite"></div>

    <h1 data-i18n="title">ImproLab: Kontrapunkt 2.0</h1>
    <div class="subtitle" data-i18n="subtitle">
        Generator dysonansu psychofizycznego.<br>
        <strong>Synteza emocji Plutchika z ruchami Labana.</strong><br>
        Zadanie wewnƒôtrzne (emocja) vs Ekspresja zewnƒôtrzna (ruch).
    </div>

    <div class="controls">
        <label for="gameMode" class="control-label" data-i18n="label_dynamics">WYBIERZ DYNAMIKƒò RELACJI:</label>
        <select id="gameMode">
            <option value="random" data-i18n="mode_random">CHAOS (Ca≈Çkowita losowo≈õƒá)</option>
            <option value="contrast" data-i18n="mode_contrast">KONTRAST (Emocje przeciwne)</option>
            <option value="clock" data-i18n="mode_clock">ZEGAR (Przesuniƒôcie o 1 stopie≈Ñ)</option>
            <option value="mirror" data-i18n="mode_mirror">LUSTRO (Ta sama emocja, inny ruch)</option>
        </select>
        <button onclick="generateScenario()" class="gen-btn" aria-keyshortcuts="Space">
            <span data-i18n="btn_generate">üé≠ Generuj Scenƒô</span>
            <span class="kbd-hint" data-i18n="key_space">Spacja</span>
        </button>
    </div>

    <div class="container">
        <!-- Postaƒá A -->
        <div class="card">
            <h2 class="card-header" data-i18n="char_a">Postaƒá A</h2>
            
            <div id="boxEmoA" class="section-emo c-radosc">
                <div class="emo-label" data-i18n="label_internal">Stan Wewnƒôtrzny (Emocja)</div>
                <div class="emo-value" id="txtEmoA">?</div>
            </div>

            <div class="emotion-vectors">
                <h3 class="vectors-title" data-i18n="label_vectors">Wektory Emocjonalne (Zadania)</h3>
                <div class="vector-grid">
                    <div class="vector-item">
                        <span class="vector-label" data-i18n="label_direction">Kierunek</span>
                        <span class="vector-value" id="vecDirA">‚Äî</span>
                    </div>
                    <div class="vector-item">
                        <span class="vector-label" data-i18n="label_impulse">Impuls</span>
                        <span class="vector-value" id="vecImpA">‚Äî</span>
                    </div>
                    <div class="vector-item">
                        <span class="vector-label" data-i18n="label_goal">Cel</span>
                        <span class="vector-value" id="vecGoalA">‚Äî</span>
                    </div>
                </div>
            </div>

            <div class="divider"></div>

            <div class="section-body">
                <h3 class="body-header" data-i18n="label_external">Stan Zewnƒôtrzny (Cia≈Ço/Laban)</h3>
                
                <div class="laban-grid">
                    <div class="factor">
                        <span class="f-label" data-i18n="label_time">CZAS</span>
                        <span class="f-val" id="qTimeA">‚Äî</span>
                    </div>
                    <div class="factor">
                        <span class="f-label" data-i18n="label_weight">WAGA</span>
                        <span class="f-val" id="qWeightA">‚Äî</span>
                    </div>
                    <div class="factor">
                        <span class="f-label" data-i18n="label_space">PRZESTRZE≈É</span>
                        <span class="f-val" id="qSpaceA">‚Äî</span>
                    </div>
                </div>

                <div class="laban-result">
                    <div class="action-name" id="resLabanA">‚Äî‚Äî‚Äî</div>
                    <div class="action-desc" id="subLabanA" data-i18n="placeholder_generate">Kliknij Generuj</div>
                </div>
            </div>
            <div class="instruction" id="instrA" data-i18n="placeholder_waiting">Czekam na instrukcje...</div>
        </div>

        <!-- Postaƒá B -->
        <div class="card">
            <h2 class="card-header" data-i18n="char_b">Postaƒá B</h2>
            
            <div id="boxEmoB" class="section-emo c-smutek">
                <div class="emo-label" data-i18n="label_internal">Stan Wewnƒôtrzny (Emocja)</div>
                <div class="emo-value" id="txtEmoB">?</div>
            </div>

            <div class="emotion-vectors">
                <h3 class="vectors-title" data-i18n="label_vectors">Wektory Emocjonalne (Zadania)</h3>
                <div class="vector-grid">
                    <div class="vector-item">
                        <span class="vector-label" data-i18n="label_direction">Kierunek</span>
                        <span class="vector-value" id="vecDirB">‚Äî</span>
                    </div>
                    <div class="vector-item">
                        <span class="vector-label" data-i18n="label_impulse">Impuls</span>
                        <span class="vector-value" id="vecImpB">‚Äî</span>
                    </div>
                    <div class="vector-item">
                        <span class="vector-label" data-i18n="label_goal">Cel</span>
                        <span class="vector-value" id="vecGoalB">‚Äî</span>
                    </div>
                </div>
            </div>

            <div class="divider"></div>

            <div class="section-body">
                <h3 class="body-header" data-i18n="label_external">Stan Zewnƒôtrzny (Cia≈Ço/Laban)</h3>
                
                <div class="laban-grid">
                    <div class="factor">
                        <span class="f-label" data-i18n="label_time">CZAS</span>
                        <span class="f-val" id="qTimeB">‚Äî</span>
                    </div>
                    <div class="factor">
                        <span class="f-label" data-i18n="label_weight">WAGA</span>
                        <span class="f-val" id="qWeightB">‚Äî</span>
                    </div>
                    <div class="factor">
                        <span class="f-label" data-i18n="label_space">PRZESTRZE≈É</span>
                        <span class="f-val" id="qSpaceB">‚Äî</span>
                    </div>
                </div>

                <div class="laban-result">
                    <div class="action-name" id="resLabanB">‚Äî‚Äî‚Äî</div>
                    <div class="action-desc" id="subLabanB" data-i18n="placeholder_generate">Kliknij Generuj</div>
                </div>
            </div>
            <div class="instruction" id="instrB" data-i18n="placeholder_waiting">Czekam na instrukcje...</div>
        </div>
    </div>

    <script>
        // S≈Çownik t≈Çumacze≈Ñ
        const translations = {
            pl: {
                title: "ImproLab: Kontrapunkt 2.0",
                subtitle: "Generator dysonansu psychofizycznego.<br><strong>Synteza emocji Plutchika z ruchami Labana.</strong><br>Zadanie wewnƒôtrzne (emocja) vs Ekspresja zewnƒôtrzna (ruch).",
                label_dynamics: "WYBIERZ DYNAMIKƒò RELACJI:",
                mode_random: "CHAOS (Ca≈Çkowita losowo≈õƒá)",
                mode_contrast: "KONTRAST (Emocje przeciwne)",
                mode_clock: "ZEGAR (Przesuniƒôcie o 1 stopie≈Ñ)",
                mode_mirror: "LUSTRO (Ta sama emocja, inny ruch)",
                btn_generate: "üé≠ Generuj Scenƒô",
                key_space: "Spacja",
                char_a: "Postaƒá A",
                char_b: "Postaƒá B",
                label_internal: "Stan Wewnƒôtrzny (Emocja)",
                label_vectors: "Wektory Emocjonalne (Zadania)",
                label_direction: "Kierunek",
                label_impulse: "Impuls",
                label_goal: "Cel",
                label_external: "Stan Zewnƒôtrzny (Cia≈Ço/Laban)",
                label_time: "CZAS",
                label_weight: "WAGA",
                label_space: "PRZESTRZE≈É",
                placeholder_generate: "Kliknij Generuj",
                placeholder_waiting: "Czekam na instrukcje...",
                // Instructions
                instr_random: "üé≤ Nie wiesz, co czuje partner. Improwizuj!",
                instr_discover: "üé≤ Nie wiesz, co czuje partner. Odkrywaj!",
                instr_conflict: "‚öîÔ∏è Jeste≈õ w emocjonalnym konflikcie z partnerem.",
                instr_opposite: "‚öîÔ∏è Twoja emocja jest odwrotno≈õciƒÖ partnera.",
                instr_initiate: "üîÑ Zainicjuj temat. Prowad≈∫ scenƒô.",
                instr_react: "üîÑ Reaguj i pr√≥buj zmieniƒá kierunek.",
                instr_same_emo: "ü™û Ta sama emocja, ale r√≥≈ºne cia≈Ça...",
                instr_same_feel: "ü™û Czujesz to samo, wyra≈ºasz inaczej.",
                // Laban Qualities
                sudden: "Nag≈Çy",
                sustained: "CiƒÖg≈Çy",
                strong: "Ciƒô≈ºki",
                light: "Lekki",
                direct: "Prosty",
                indirect: "Okrƒô≈ºny",
                announcement_template: "Wygenerowano nowƒÖ scenƒô. Postaƒá A: {emoA}, {labanA}. Postaƒá B: {emoB}, {labanB}."
            },
            en: {
                title: "ImproLab: Counterpoint 2.0",
                subtitle: "Psychophysical Dissonance Generator.<br><strong>Synthesis of Plutchik's emotions and Laban's movements.</strong><br>Internal task (emotion) vs External expression (movement).",
                label_dynamics: "CHOOSE RELATIONSHIP DYNAMICS:",
                mode_random: "CHAOS (Total randomness)",
                mode_contrast: "CONTRAST (Opposite emotions)",
                mode_clock: "CLOCK (Shift by 1 step)",
                mode_mirror: "MIRROR (Same emotion, different movement)",
                btn_generate: "üé≠ Generate Scene",
                key_space: "Space",
                char_a: "Character A",
                char_b: "Character B",
                label_internal: "Internal State (Emotion)",
                label_vectors: "Emotional Vectors (Tasks)",
                label_direction: "Direction",
                label_impulse: "Impulse",
                label_goal: "Goal",
                label_external: "External State (Body/Laban)",
                label_time: "TIME",
                label_weight: "WEIGHT",
                label_space: "SPACE",
                placeholder_generate: "Click Generate",
                placeholder_waiting: "Waiting for instructions...",
                // Instructions
                instr_random: "üé≤ You don't know what your partner feels. Improvise!",
                instr_discover: "üé≤ You don't know what your partner feels. Discover!",
                instr_conflict: "‚öîÔ∏è You are in emotional conflict with your partner.",
                instr_opposite: "‚öîÔ∏è Your emotion is the opposite of your partner's.",
                instr_initiate: "üîÑ Initiate the topic. Lead the scene.",
                instr_react: "üîÑ React and try to change direction.",
                instr_same_emo: "ü™û Same emotion, but different bodies...",
                instr_same_feel: "ü™û You feel the same, but express it differently.",
                // Laban Qualities
                sudden: "Sudden",
                sustained: "Sustained",
                strong: "Strong",
                light: "Light",
                direct: "Direct",
                indirect: "Indirect",
                announcement_template: "New scene generated. Character A: {emoA}, {labanA}. Character B: {emoB}, {labanB}."
            }
        };

        let currentLang = 'pl';

        // Model Ko≈Ça Plutchika z Wektorami Emocjonalnymi
        const emotions = [
            { 
                name: { pl: "Rado≈õƒá", en: "Joy" },
                class: "c-radosc",
                vectors: {
                    kierunek: { pl: "W G√ìRƒò", en: "UP" },
                    impuls: { pl: "EKSPANSJA", en: "EXPANSION" },
                    cel: { pl: "POKAZAƒÜ SIƒò", en: "SHOW OFF" }
                }
            },
            { 
                name: { pl: "Zaufanie", en: "Trust" },
                class: "c-zaufanie",
                vectors: {
                    kierunek: { pl: "OTWARCIE", en: "OPENING" },
                    impuls: { pl: "MIƒòKKO≈öƒÜ", en: "SOFTNESS" },
                    cel: { pl: "PRZYJƒÑƒÜ", en: "ACCEPT" }
                }
            },
            { 
                name: { pl: "Strach", en: "Fear" },
                class: "c-strach",
                vectors: {
                    kierunek: { pl: "DO TY≈ÅU", en: "BACKWARDS" },
                    impuls: { pl: "NAPIƒòCIE", en: "TENSION" },
                    cel: { pl: "UCIEC", en: "ESCAPE" }
                }
            },
            { 
                name: { pl: "Zdziwienie", en: "Surprise" },
                class: "c-zdziwienie",
                vectors: {
                    kierunek: { pl: "STOP", en: "STOP" },
                    impuls: { pl: "SZOK", en: "SHOCK" },
                    cel: { pl: "ZORIENTOWAƒÜ", en: "ORIENT" }
                }
            },
            { 
                name: { pl: "Smutek", en: "Sadness" },
                class: "c-smutek",
                vectors: {
                    kierunek: { pl: "W D√ì≈Å", en: "DOWN" },
                    impuls: { pl: "CIƒò≈ªAR", en: "WEIGHT" },
                    cel: { pl: "WYCOFAƒÜ SIƒò", en: "WITHDRAW" }
                }
            },
            { 
                name: { pl: "Wstrƒôt", en: "Disgust" },
                class: "c-wstret",
                vectors: {
                    kierunek: { pl: "ODRZUT", en: "RECOIL" },
                    impuls: { pl: "SKURCZ", en: "CONTRACTION" },
                    cel: { pl: "WYPLUƒÜ", en: "SPIT OUT" }
                }
            },
            { 
                name: { pl: "Gniew", en: "Anger" },
                class: "c-gniew",
                vectors: {
                    kierunek: { pl: "DO PRZODU", en: "FORWARD" },
                    impuls: { pl: "GORƒÑCO", en: "HEAT" },
                    cel: { pl: "ZNISZCZYƒÜ", en: "DESTROY" }
                }
            },
            { 
                name: { pl: "Oczekiwanie", en: "Anticipation" },
                class: "c-oczekiwanie",
                vectors: {
                    kierunek: { pl: "SKANOWANIE", en: "SCANNING" },
                    impuls: { pl: "CZUJNO≈öƒÜ", en: "VIGILANCE" },
                    cel: { pl: "BADAƒÜ", en: "INVESTIGATE" }
                }
            }
        ];

        // 8 Akcji Rudolfa Labana (Effort Actions)
        function getRandomLaban() {
            const isSudden = Math.random() < 0.5;
            const isStrong = Math.random() < 0.5;
            const isDirect = Math.random() < 0.5;

            // Ustalanie nazwy akcji na podstawie kombinacji
            let action = "";
            let desc = { pl: "", en: "" };

            if (isDirect && isStrong && isSudden) { 
                action = "PUNCH"; 
                desc = { pl: "Boksowanie / Pchniƒôcie", en: "Boxing / Thrust" };
            } else if (isDirect && isStrong && !isSudden) { 
                action = "PRESS"; 
                desc = { pl: "Naciskanie / Mia≈ºd≈ºenie", en: "Pressing / Crushing" };
            } else if (isDirect && !isStrong && isSudden) { 
                action = "DAB"; 
                desc = { pl: "Punktowanie / Delikatny dotyk", en: "Dabbing / Light touch" };
            } else if (isDirect && !isStrong && !isSudden) { 
                action = "GLIDE"; 
                desc = { pl: "≈ölizg / G≈Çadzenie", en: "Gliding / Smoothing" };
            } else if (!isDirect && isStrong && isSudden) { 
                action = "SLASH"; 
                desc = { pl: "Ciƒôcie / Smagniƒôcie", en: "Slashing / Whipping" };
            } else if (!isDirect && isStrong && !isSudden) { 
                action = "WRING"; 
                desc = { pl: "Wy≈ºymanie / Skrƒôcanie", en: "Wringing / Twisting" };
            } else if (!isDirect && !isStrong && isSudden) { 
                action = "FLICK"; 
                desc = { pl: "Pstrykniƒôcie / StrzƒÖ≈õniƒôcie", en: "Flicking / Shaking off" };
            } else if (!isDirect && !isStrong && !isSudden) { 
                action = "FLOAT"; 
                desc = { pl: "Unoszenie / Dryfowanie", en: "Floating / Drifting" };
            }

            return {
                time: isSudden ? "sudden" : "sustained",
                weight: isStrong ? "strong" : "light",
                space: isDirect ? "direct" : "indirect",
                name: action,
                desc: desc
            };
        }

        let lastScenarioData = null;

        function updateCard(role, emoIdx, instructionKey) {
            const emo = emotions[emoIdx];
            // If called from generateScenario, we generate new Laban.
            // If called from setLanguage, we should ideally keep the same Laban and Emotion but translate them.
            // However, simpliest way is to store the indices and seeds or just regenerate.
            // To be user friendly, when switching language, we shouldn't regenerate the scenario.
            // So we need to separate data generation from rendering.
        }

        // Separate State
        let state = {
            charA: { emoIdx: 0, laban: null, instrKey: "" },
            charB: { emoIdx: 0, laban: null, instrKey: "" }
        };

        function triggerAnimation(el) {
            el.classList.remove('animate-pop');
            void el.offsetWidth; // trigger reflow
            el.classList.add('animate-pop');
        }

        function render(shouldAnimate = false) {
            const t = translations[currentLang];

            // Static text
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) {
                    el.innerHTML = t[key];
                }
            });

            // Update Cards if state is initialized
            if (state.charA.laban && state.charB.laban) {
                renderCard('A', state.charA, shouldAnimate);
                renderCard('B', state.charB, shouldAnimate);
            }
        }

        function renderCard(role, charState, shouldAnimate) {
            const t = translations[currentLang];
            const emo = emotions[charState.emoIdx];
            const laban = charState.laban;

             // Ustawienia Emocji
            const emoBox = document.getElementById(`boxEmo${role}`);
            
            // Reset klas i dodanie nowych
            emoBox.className = 'section-emo';
            emoBox.classList.add(emo.class);

            if (shouldAnimate) {
                triggerAnimation(emoBox);
            }
            
            document.getElementById(`txtEmo${role}`).innerText = emo.name[currentLang];

            // Ustawienia Wektor√≥w Emocjonalnych
            document.getElementById(`vecDir${role}`).innerText = emo.vectors.kierunek[currentLang];
            document.getElementById(`vecImp${role}`).innerText = emo.vectors.impuls[currentLang];
            document.getElementById(`vecGoal${role}`).innerText = emo.vectors.cel[currentLang];

            // Ustawienia Labana
            document.getElementById(`qTime${role}`).innerText = t[laban.time];
            document.getElementById(`qWeight${role}`).innerText = t[laban.weight];
            document.getElementById(`qSpace${role}`).innerText = t[laban.space];
            
            document.getElementById(`resLaban${role}`).innerText = laban.name;
            document.getElementById(`subLaban${role}`).innerText = laban.desc[currentLang];

            // Instrukcja
            document.getElementById(`instr${role}`).innerText = t[charState.instrKey];

            if (shouldAnimate) {
                 triggerAnimation(document.querySelector(`#resLaban${role}`).parentNode);
            }
        }

        function generateScenario() {
            const mode = document.getElementById("gameMode").value;
            
            const idxA = Math.floor(Math.random() * 8);
            let idxB;
            let instrKeyA = "";
            let instrKeyB = "";

            switch (mode) {
                case "random":
                    idxB = Math.floor(Math.random() * 8);
                    instrKeyA = "instr_random";
                    instrKeyB = "instr_discover";
                    break;
                case "contrast":
                    idxB = (idxA + 4) % 8;
                    instrKeyA = "instr_conflict";
                    instrKeyB = "instr_opposite";
                    break;
                case "clock":
                    idxB = (idxA + 1) % 8;
                    instrKeyA = "instr_initiate";
                    instrKeyB = "instr_react";
                    break;
                case "mirror":
                    idxB = idxA;
                    instrKeyA = "instr_same_emo";
                    instrKeyB = "instr_same_feel";
                    break;
            }

            state.charA = {
                emoIdx: idxA,
                laban: getRandomLaban(),
                instrKey: instrKeyA
            };

            state.charB = {
                emoIdx: idxB,
                laban: getRandomLaban(),
                instrKey: instrKeyB
            };

            render(true);
            announceScenario();
        }

        function announceScenario() {
            const t = translations[currentLang];
            const emoA = emotions[state.charA.emoIdx].name[currentLang];
            const labanA = state.charA.laban.desc[currentLang];
            const emoB = emotions[state.charB.emoIdx].name[currentLang];
            const labanB = state.charB.laban.desc[currentLang];

            const announcement = t.announcement_template
                .replace("{emoA}", emoA)
                .replace("{labanA}", labanA)
                .replace("{emoB}", emoB)
                .replace("{labanB}", labanB);

            document.getElementById("a11y-announcer").textContent = announcement;
        }

        function setLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;

            // Update buttons
            const btnPl = document.getElementById('btn-pl');
            const btnEn = document.getElementById('btn-en');

            btnPl.classList.toggle('active', lang === 'pl');
            btnEn.classList.toggle('active', lang === 'en');

            btnPl.setAttribute('aria-pressed', lang === 'pl');
            btnEn.setAttribute('aria-pressed', lang === 'en');

            render(false);
        }

        // Uruchom przy starcie
        window.onload = function() {
            generateScenario();

            // Add keyboard support (Spacebar to generate)
            document.addEventListener('keydown', function(event) {
                if (event.code === 'Space' && event.target.tagName !== 'BUTTON' && event.target.tagName !== 'SELECT') {
                    event.preventDefault(); // Prevent scrolling
                    generateScenario();
                }
            });
        };

    </script>
</body>
</html>